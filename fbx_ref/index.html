<html>
	<style>
        body {font-family: Arial;}

        td, th {
        	white-space:nowrap;
        	text-align: center;
        }
	</style>
	<head>
		<meta charset="utf-8">
		<title>FBX</title>
		<script src="https://cdn.plot.ly/plotly-2.2.0.min.js"></script>
		<script>
		String.prototype.format = function() {
		    var i=0, args=arguments;
		    return this.replace(/{}/g, function() {
		        return typeof args[i] != 'undefined' ? args[i++] : '';
		    });
		};

		function sort_by_key(array, key)
		{
		     return array.sort(function(a, b)
		     {
		          var x = a[key]; var y = b[key];
		          return ((x < y) ? -1 : ((x > y) ? 1 : 0));
		     });
		}

		function Get(sourceUrl){
		    var Httpreq = new XMLHttpRequest();
		    Httpreq.open("GET", sourceUrl, false);
		    Httpreq.send(null);
		    return Httpreq.responseText;
		}

		function onload()
		{
		    jsonStr = Get("https://wanquan.github.io/fbx_ref/fbxDaily.json");
		    var fbxData = JSON.parse(jsonStr);
		    fbxData = fbxData['indexPoints'];
		    fbxData = sort_by_key(fbxData, 'indexDate');
		    xData = [];
		    yData = [];
		    for (var i = 0;i<fbxData.length; i++)
		    {
		        xData[i] = fbxData[i].indexDate;
		        yData[i] = fbxData[i].value;
		    }
		    drawChart(xData, yData);
		    drawTable(xData, yData);
		}

		function drawTable(xData, yData)
		{
		    var result = '<table style="width: 300px; margin:0 auto; border:1px solid; padding:5px;" rules="all" cellpadding="5";>';
		    result += "<tr><th>Date</th><th>Index</th></tr>";
		    for(var i= xData.length-1; i>=0; i--)
		    {
		        result += "<tr><td>{}</td><td>{}</td></tr>".format(xData[i], yData[i]);
		    }
		    result += "</table>";
		    document.getElementById("fbxTable").innerHTML = result;
		}

		function drawChart(xData, yData)
		{
		    var layout = {
		        title: "FBX Daily Index ( {}: {} )".format(xData[xData.length-1], yData[yData.length-1]),
		        xaxis: {
		            autorange: true,
		            rangeslider: true,
		            type: 'date'
		        },
		        yaxis: {
		            autorange: true,
		            type: "linear"
		        },
		        width: 1000,
		        height: 500,
		    };
		    var data = [{
		        x: xData,
		        y: yData,
		        type: 'scatter',
		    }];

		    Plotly.newPlot('fbxChart', data, layout)
		}

		</script>

	</head>
	<body id="abc" onload=onload()>
		<div style="  text-align: center; width:1100px; margin: 0 auto;">
			CREDIT TO: <a href="https://fbx.freightos.com/">FBX</a><br>
		</div>
		<div id='fbxChart' style="width:1100px; margin: 0 auto;"></div>
		<div id='fbxTable' style="width:1100px; margin: 0 auto;"></div>
	</body>
</html>
